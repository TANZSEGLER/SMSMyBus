
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html>
  <head>
    <meta name="description" content="A telephone application that lets check Madison bus schedules in real time.">
    <meta name="keywords" content"Twilio, bus schedule, SMS, google app engine, cloud computing, telephone, telephony, smsmybus">
    <title>SMSMyBuss - Check the bus schedule in real time</title>
    <link rel="stylesheet" href="style.css">

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script> 
    <script type="text/javascript" src="/jquery.timers-1.2.js"></script>

    <script type="text/javascript">
      function refreshTimes() {
    	  var customurl = "/rest/"+$('#stop').val()+"/";
           $.ajax({
            type: "GET",
            url: customurl,
            data: "",
            success: function(xml) {
      	      if($("status",xml).text() == "-1") {
          	   $("#estimates").replaceWith('<p id="estimates" style="color:red;font-weight: bold">Error retrieving that route/stop combination!</p>');
          	   alert("Illegal request");
      	      }
      	      else {
          	   var stopID = $("stop",xml).text();
      	       var timestamp = $("timestamp",xml).text();
      	       $("route",xml).each(function(id) {
          	       var routeID = $(this).find('routeID').text();
          	       var human = $(this).find('human').text();
          	       var minutes = $(this).find('minutes').text();
          	       var arrival = $(this).find('arrivalTime').text();
          	       var destination = $(this).find('destination').text();
          	       //alert(human);
          	       $("#estimates").append("Route "+routeID+" arrives in "+minutes+" minutes<br/>");
      	       });
      	       
          	   //$("#estimates").replaceWith('<p id="estimates">Route '+routeID+', Stop '+stopID+' will be arriving in...<br><br>')
      	       //$("minutes",xml).each(function(id) {  
      	          //time = $(this).text();
      	          //$("#estimates").append(time+" minutes<br/>");  
        	      //});
     	       //$("#estimates").append('<p style="font-size: 12px;">(as of '+timestamp+')</p>');
      	      }   
            } // success function
          }); // .ajax
      } // refreshTimes
      
      $(document).everyTime("65s",function() {
          //alert("refresh");
          refreshTimes();
	  });
    </script>

    <script type="text/javascript">
      $(document).ready(function() {
          $("#request-form").submit(refreshTimes);
      });
    </script>
    

  </head>

<body>  

<div id="page-container">
 <div id="header">
 {{ greeting }}<br>
 <p><center><img src="img/header.png" alt="smsmybus logo"></center>
 </div>
 <div id="description">
  <center>SMSMyBus is a mobile telephone application that lets you find real time bus arrivals for 
  the <a class="description-anchor" href=http://www.cityofmadison.com/metro/>Madison Metro</a>.
  Just text your request to 608.467.1603 to receive <i>real time</i> arrival estimates.</center>
  <hr>
 </div>
 
 <div id="query-form">
    <form id="request-form" onsubmit="return false">
     <table border=0>
      <tr>
      <td>Stop ID:</td>
      <td><input id="stop" type=text size=5 name="stop"></td>
      </tr>
      <tr><td colspan=2><input type=submit value=Submit></td></tr>
     </table>
    </form>
 </div>
 <hr>
 
 <div id="spacer"> </div>
 
 <h2>Estimates:</h2>
 <div class="form-answer">
  <p id="estimates"></p>
 </div>
 
 <hr>
 <div id="footer">
  <div id="powered-by">
     powered by:<br><br>
     <a href=http://code.google.com/appengine/><img src="img/gae-logo.png" alt="google app engine" height="30" width="30"></a>
     <a href=http://twilio.com><img src="img/twilio-logo.jpg" alt="twilio" height="30" width="30"></a>
  </div>
  <div id="me">
   <a href=http://www.gregtracy.com>Greg Tracy</a> - <a href=http://twitter.com/gregtracy>@gregtracy</a>
  </div>
  <div id="contact-container">
   terms - privacy - <a href="mailto:greg@gregtracy.com?subject=SMSMyBus%20feedback">feedback</a>
  </div>
 </div>
</div>



<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-2237321-13");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>

